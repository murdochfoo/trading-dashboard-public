#!/bin/bash
# âª Emergency Rollback - Just run: ./rollback

echo "âª EMERGENCY ROLLBACK"
echo "===================="

cd /home/ib/trading-dashboard-dev

# Warning
echo "âš ï¸  WARNING: This will undo the last deployment!"
echo ""
read -p "Are you sure? Type 'yes' to continue: " -r
echo ""

if [[ ! $REPLY =~ ^[Yy][Ee][Ss]$ ]]; then
    echo "âŒ Rollback cancelled"
    exit 1
fi

# Go to main branch and rollback
git checkout main
git pull origin main

# Show last few commits
echo "ğŸ“œ Recent commits:"
git log --oneline -5

echo ""
read -p "How many commits to rollback? (usually 1): " -r commits
commits=${commits:-1}

# Rollback
git reset --hard HEAD~$commits

# Force push (careful!)
echo "âª Rolling back $commits commit(s)..."
git push --force-with-lease origin main

echo ""
echo "âœ… ROLLBACK COMPLETE!"
echo "ğŸŒ Website will update in ~2-3 minutes"
echo "ğŸ” Check status: ./check-live"